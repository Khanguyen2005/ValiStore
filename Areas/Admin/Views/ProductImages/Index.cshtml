@model IEnumerable<ValiModern.Models.EF.Product_Images>
@{
 var product = ViewBag.Product as ValiModern.Models.EF.Product;
 ViewBag.Title = "Product Images";
 Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}
<div class="container-xl py-3">
 <div class="d-flex justify-content-between align-items-center mb-3">
 <h2 class="h5 fw-bold mb-0">Images - @product?.name (ID:@product?.id)</h2>
 <div>
 <a href="@Url.Action("Index","Product")" class="btn btn-sm btn-outline-secondary">Back to products</a>
 <a href="@Url.Action("Create", new { productId = product.id })" class="btn btn-sm btn-primary ms-1"><i class="bi bi-upload"></i> Upload</a>
 </div>
 </div>
 @if (TempData["Success"] != null){ <div class="alert alert-success">@TempData["Success"]</div> }
 @if (TempData["Error"] != null){ <div class="alert alert-danger">@TempData["Error"]</div> }
 <form method="post" action="@Url.Action("UpdateOrder")" class="mb-3">
 @Html.AntiForgeryToken()
 @Html.Hidden("productId", product.id)
 <div class="row g-3">
 @foreach (var img in Model)
 {
 <div class="col-6 col-md-3">
 <div class="border rounded-3 p-2 position-relative h-100">
 <img src="@img.image_url" alt="image" class="img-fluid rounded mb-2" style="max-height:160px;object-fit:cover;" />
 <div class="d-flex justify-content-between align-items-center mb-2">
 <small class="text-muted">ID:@img.id</small>
 @if (img.is_main){<span class="badge bg-primary">Main</span>} else {<span class="badge bg-secondary">Extra</span>}
 </div>
 <div class="mb-2">
 <label class="form-label small">Sort</label>
 <input type="hidden" name="ids" value="@img.id" />
 <input type="number" name="orders" value="@img.sort_order" class="form-control form-control-sm" />
 </div>
 <div class="d-flex justify-content-between">
 <form method="post" action="@Url.Action("SetMain")" class="me-1">
 @Html.AntiForgeryToken()
 @Html.Hidden("id", img.id)
 <button type="submit" class="btn btn-sm btn-outline-info" @(img.is_main?"disabled":"")>Set Main</button>
 </form>
 <form method="post" action="@Url.Action("Delete")" onsubmit="return confirm('Delete this image?');">
 @Html.AntiForgeryToken()
 @Html.Hidden("id", img.id)
 <button type="submit" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></button>
 </form>
 </div>
 </div>
 </div>
 }
 </div>
 <div class="mt-3">
 <button type="submit" class="btn btn-success btn-sm"><i class="bi bi-save"></i> Save Order</button>
 </div>
 </form>
</div>